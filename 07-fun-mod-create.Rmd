# Generators

Generators create audible sound.
Chapter \@ref(basic-modeling-concepts) introduced oscillators, which are the prototypical generator.
This chapter expands upon oscillators and how they can be combined together to produce fuller and more interesting sounds.
Additionally, two new generators are introduced, noise and samplers.
Noise can also be combined with oscillators and other generators to create richer and more realistic sound.
Samplers represent the extreme of realism in generators, at least as far as their digital representation allows.

<!-- https://docs.google.com/document/d/19EkU7Ypa6J5FYPeDNzVzeNc1qc1sGrxfDMu7Nw2PAgU/edit -->

## Chords 

<!-- chords -->
<!-- - chords from clock division; suboctaves from clock divider -->
<!-- - chords from voltage division -->

Section \@ref(phase-reflections-standing-waves-and-harmonics) briefly mentioned the relationship between harmonics and fundamental relationships like octaves and fifths.
To recap, the second harmonic has double the frequency of the first and so is one octave above the first harmonic.
We can express this relationship as 2:1, i.e. an octave is twice the frequency of the the fundamental.
Similarly the third harmonic is a fifth above the second harmonic, so we can express a fifth as 3:2.^[Whole number ratios require [just intonation](https://en.wikipedia.org/wiki/Just_intonation). The twelve tone [equal temperment](https://en.wikipedia.org/wiki/Equal_temperament) used in Western music is a close approximation, e.g. 3:2 is 1.498 in twelve tone equal temperment.]

Now consider what happens if two notes an octave apart or a fifth apart are played at the same time.
Clearly some of their harmonics will be the same.
Thus playing two or more notes this way will add and enhance harmonics beyond that of a single note, creating a richer and fuller sound.
Of course, notes may be played that are not harmonically related, to a different effect.^[The reader may be interested in [consonance/dissonance](https://en.wikipedia.org/wiki/Consonance_and_dissonance) as discussed in music theory.]
When two notes are played simultaneously, it is called an [interval](https://en.wikipedia.org/wiki/Interval_(music)), with three notes, a [trichord](https://en.wikipedia.org/wiki/Trichord), with four notes, a [tetrachord](https://en.wikipedia.org/wiki/Tetrachord), etc.
Many harmonically related notes can be played simultaneously to good effect.
For example, the [THX Deep Note](https://en.wikipedia.org/wiki/Deep_Note) in Figure \@ref(fig:deep-note) resolves to 11 notes, mostly harmonically related by 3, 4, and 7 semitones (minor/major thirds and fifths). 

(ref:deep-note) [Youtube video](https://www.youtube.com/watch?v=sPY3Y2qhyXk) of the THX Deep Note, which resolves to 11 harmonically related notes. Image [© THX Ltd](https://www.youtube.com/c/THXLtd).

```{r deep-note, fig.cap="(ref:deep-note)", echo = F}
embed_youtube("sPY3Y2qhyXk",5)
```

In modular synthesis, there are at least two ways to create chords, which correspond to stages of the process to create a single note.
At the first stage, we have a V/Oct control signal, so we can create chords by making new control signals harmonically related to the original signal.
At the final stage, we have an audio signal, so we can create chords by making new audio signals harmonically related to the original signal.
Let's look at both.

To create harmonically related control voltage signals, we can use a voltage offset module to create new signals offset from the original signal, i.e. the original voltage plus/minus a harmonically-related voltage.
It can take a little math to do this if the offset module is labeled in volts^[Recall 1 V/Oct means a semitone is 1/12 of a volt.], but if the offset module is labeled in semitones, it is [fairly straightforward](https://en.wikipedia.org/wiki/Interval_(music)#Main_intervals), e.g. a fifth is seven semitones.
Additionally we will need multiple oscillators to play a note for each offset voltage.
We could reasonably do this with separate oscillators, but some chord-oriented modules contain multiple oscillators and take separate V/Oct for each.
Try making a trichord using a fifth and an octave using the button in Figure \@ref(fig:voltage-division-chords).

(ref:voltage-division-chords) [Virtual modular](https://cardinal.olney.ai) for making a chord using signal offsets.

<!-- MODAL HTML BLOCK -->
```{r echo=F, out.width="100%"}
modular_modal("voltage-division-chords", starter_file="empty.vcv", instructions_html="<ul>
<li>Add 12-Key and Host audio</li>
<li>Add BST (voltage offset) and D'Acchord (multiple oscillator) </li>
<li>Connect 12-Key CV out to BST bias 1 input</li>
<li>Make sure the Volts/Semi switch is set to semi</li>
<li>Set BST bias 1 output to +0st (root note) and connect to D'Acchord P1</li>
<li>Set BST bias 2 output to +7st (fifth) and connect to D'Acchord P2</li>
<li>Set BST bias 3 output to +12st (octave) and connect to D'Acchord P3</li>
<li>Connect D'Accord Left/Right to Host audio Left/Right</li>
<li>Try the following and note the differences in the sound<ul>
<li>Use the ATTN row of knobs in D&#39;Accord to remove all but the root note</li>
<li>Add each the others back in slowly, noting the change in the sound</li>
<li>Play the keyboard and note the stability of the chord across keys </li>
</ul>
</li>
</ul>
<div class='d-flex flex-row justify-content-around'>
<img src='images/solo-modules/bst-voltage-divider-solo.png' style='height: 300px; width: auto'>
<img src='images/solo-modules/dacchord-solo.png' style='height: 300px; width: auto'>
</div>
",solution_html="<img src='images/patch-solutions/voltage-division-chords.png' style='height: 300px; width: auto'>")
```

<!-- CAPTION BLOCK -->
```{r voltage-division-chords, echo=F, out.width="100%", fig.cap="(ref:voltage-division-chords)"}
modular_caption()
```

To create harmonically related audio signals, we can use a clock divider as long as the original signal can be interpreted as clock and the clock divider in question can accept audio rates.
This approach is related to a classic technique for creating a fatter sound, the sub-octave square wave.
A sub-octave square wave is exactly that: a square wave one octave below the fundamental.
Since a clock division of $/2$ cuts the source clock frequency in half, we can easily generate a sub-octave square wave using a clock divider, albeit with the same assumptions.
Perhaps more interestingly, if our clock divider supports both even and odd divisions we can create subharmonic chords, or perhaps more appropriately, an [inverted chord](https://en.wikipedia.org/wiki/Inversion_(music)). 
All that is required is knowing the harmonic ratios mentioned above, e.g. 3:2 means that the divisions $/3$ and $/2$ are a fifth apart.
Try making a trichord using a fifth and an octave using the button in Figure \@ref(fig:clock-division-chords).

(ref:clock-division-chords) [Virtual modular](https://cardinal.olney.ai) for making a chord using clock divisions.

<!-- MODAL HTML BLOCK -->
```{r echo=F, out.width="100%"}
modular_modal("clock-division-chords", starter_file="voltage-division-chords.vcv", instructions_html="<ul>
<li>Remove modules except for 12-Key and Host audio</li>
<li>Add VCO, dividah (even clock divider), D1v1de (adjustable clock divider), Scope, and QuadVCA/Mixer </li>
<li>Connect 12-Key CV out to VCO V/Oct</li>
<li>Connect VCO Sqr out to dividah Clock in, D1v1de in, Scope in 1, and QuadVCA in 1</li>
<li>Connect dividah by 2 out to Scope in 2 and QuadVCA in 2</li>
<li>Connect D1v1de out to QuadVCA in 3 and set D1v1de clock division to 3</li>
<li>Connect QuadVCA mix out to Host audio L</li>
<li>Use the scope to confirm the divided signals are correctly aligned to the VCO</li>
<li>Try the following and note the differences in the sound<ul>
<li>Use the QuadVCA sliders to mute all but the root note</li>
<li>Add each the others back in slowly, noting the change in the sound</li>
<li>Play the keyboard and note the stability of the chord across keys </li>
</ul>
</li>
</ul>
<div class='d-flex flex-row justify-content-around'>
<img src='images/solo-modules/dividah-solo.png' style='height: 300px; width: auto'>
<img src='images/solo-modules/d1v1de-solo.png' style='height: 300px; width: auto'>
</div>
",solution_html="<img src='images/patch-solutions/clock-division-chords.png' style='height: 300px; width: auto'>")
```

<!-- CAPTION BLOCK -->
```{r clock-division-chords, echo=F, out.width="100%", fig.cap="(ref:clock-division-chords)"}
modular_caption()
```

## Chorus

We can also combine different oscillators using the same, or almost the same pitch.
As discussed in Section \@ref(phase-reflections-standing-waves-and-harmonics), two identical waves will constructively interfere with each other and produce a new wave with twice the amplitude.
However, if the waves are slightly out of phase or have slightly different frequencies, a subtle interference pattern will be produced that slowly changes the amplitude and timbre of the sound over time.
This effect is used in pianos, which have more than one string for most notes, as well as 12-string guitars that have six pairs of identical strings.
In fact, this effect is so general is used as an audio processing effect called [chorus](https://en.wikipedia.org/wiki/Chorus_(audio_effect)).

To achieve this effect in modular, one only needs to slightly detune one of the VCOs with respect to the other or change the phase relationship between oscillators.
Typically two independent oscillators will already be out of phase, but in modules that contain multiple oscillators there is sometimes a control to adjust the phase of one oscillator with respect to the others.
Both detuning and phase changes must be subtle in order to increase the richness of the sound.
If the detuning is too great, two different pitches will be perceived as out of tune rather than a richer single sound.
Similarly, as phase is increased there is greater destructive interference and potentially cancellation when completely out of phase.
Remember that most interference will create spans of sound with greater loudness and quietness, as shown as shown in Figure \@ref(fig:beat-freq).

(ref:beat-freq) [Animation](https://olney.ai/ct-modular-book/images/beat-freq.gif) of interfering sine waves as one increases in frequency. Note how multiple beats appear in this short span as the frequency increases. Image [© Adjwilley/CC-BY-SA-3.0](https://commons.wikimedia.org/wiki/File:WaveInterference.gif).

```{r beat-freq, echo=F, out.width="65%", fig.cap="(ref:beat-freq)"}
  embed_linked_media("images/beat-freq.gif")
```

These changes in volume can be perceived as [beats](https://en.wikipedia.org/wiki/Beat_(acoustics)) if they are strong enough and occur within a certain range of frequencies.
Typically such beats are unwanted, so the interference between the sound waves should either be too slow/fast to be perceive as beats or the beats themselves are so soft that they are not perceived as beats.
Returning to the first patch, try to detuning the oscillator a fifth above the root while silencing the oscillator an octave above, using the button in Figure \@ref(fig:clock-division-chords).
You should hear a beat whose beat increases as you increase detuning.

(ref:detune-beat) [Virtual modular](https://cardinal.olney.ai) for detuning a second oscillator.

<!-- MODAL HTML BLOCK -->
```{r echo=F, out.width="100%"}
modular_modal("detune-beat", starter_file="voltage-division-chords.vcv", instructions_html="<ul>
<li>Silence P3 using the ATTN knob </li>
<li>Detune P2 using the Detune knob</li>
<li>Note the beat whose frequency increases with detuning</li>
<li>At what point of detuning do you think it sounds best?</li>
",solution_html="<img src='images/patch-solutions/detune-beat.png' style='height: 300px; width: auto'>")
```

<!-- CAPTION BLOCK -->
```{r detune-beat, echo=F, out.width="100%", fig.cap="(ref:detune-beat)"}
modular_caption()
```

## Low frequency oscillators & uses

Low frequency oscillators (LFOs) are modules that produce waves at frequencies below audio rates.
It may seem strange to introduce LFOs in a chapter on generators, which by our definition create audible sound.
The reason is that LFOs are essentially identical to regular oscillators (VCOs) except that LFOs operate at lower frequencies.
In fact, it's common to find LFOs that can operate at audio rates and VCOs that operate below audio rates.
One other common difference is that LFOs often have a unipolar switch.
The switch changes the output of the LFO, which are by default bipolar and range from -5 to +5 V, to unipolar output of 0 to 10 V.
We've already met a unipolar LFO by another name - a clock is a unipolar LFO that uses a pulse wave!

LFOs have many potential uses, but perhaps the most prominent is to add movement to a sound.
For example, it's generally thought that chorus adds to sound through movement, specifically movement caused by interference and changing harmonics.
LFOs can create similar movement in other contexts as described below.
What all these contexts share is two properties: the speed of the movement (frequency) and the depth of the movement (amplitude).

### Pulse width modulation

LFOs can create the effect of two interfering oscillators with only one VCO.
This is an interesting effect in its own right, but is particularly valuable when only one VCO is present.
The prototypical case for this effect is with pulse waves, where it is called pulse width modulation (PWM).
As a motivating example, consider Figure \@ref(fig:pwm), which shows the interference  of two pulse waves at 25% and 50% duty cycles, respectively.
The resulting wave looks like the 25% wave where the wave is positive and like the 50% wave where the wave is negative.
This occurs because the two component waves, which have the same amplitude, combine to either exactly double the amplitude or sum to zero at all points of the wave. 

(ref:pwm) Interference of a pulse wave with 25% duty cycle (gold) with a pulse wave with a 50% duty cycle (blue). Note the resulting wave (green) has a positive signal matching the 25% wave and a negative signal matching the 50% wave. Waves are offset for comparison.

```{r pwm, fig.cap="(ref:pwm)", echo = F, message=F, warning=F,dev='png'}
library(gsignal)
x <- seq(0, 5, length.out = 1e3)
square_50 <- square(2 * pi * 1 *x, duty = 50)
plot(x, square_50, type="l", xlab = "", ylab = "", main = "",col="blue",lwd=2,lty=3, ylim = c(- 2, 2))
abline(0,0,col="black")

square_25 <- square(2 * pi * 1 *x, duty = 25)
lines( x + .04, square_25, col="gold", lwd=2,lty=3)

lines( x + .08, square_25 + square_50, col="green",lwd=3)
```

Because this is such a useful and interesting effect, many oscillators that produce pulse waves have a PWM input that allows the duty cycle of the wave to be controlled by another module.
Try to implement PWM with an LFO using the button in Figure \@ref(fig:pwm-lfo-vco-scope).
If you hook up the VCO square wave to a scope, you can see the resulting waveshape.
The LFO frequency and the PWM depth knobs give control over the speed of the PWM and the depth (i.e. the range of duty cycles covered), respectively.


(ref:pwm-lfo-vco-scope) [Virtual modular](https://cardinal.olney.ai) for implementing pulse width modulation (PWM) using a low frequency oscillator (LFO).

<!-- MODAL HTML BLOCK -->
```{r echo=F, out.width="100%"}
modular_modal("pwm-lfo-vco-scope", starter_file="empty.vcv", instructions_html="<ul>
<li>Add LFO, VCO, Scope, and Host audio </li>
<li>Connect LFO triangle out to VCO PWM</li>
<li>Connect VCO square out to  Scope in 1</li>
<li>Connect LFO triangle out to  Scope in 2</li>
<li>Connect Scope out 1 to Host audio L</li>
<li>Adjust the scope to visualize the wave</li>
<li>Try the following and note the differences in the sound (richness/beats)<ul>
<li>Increase the depth of the PWM by adjusting the PWM knob on the VCO (the knob adjusts an internal VCA)</li>
<li>Turn the LFO frequency to zero to hear the raw wave, then increase frequency</li>
<li>Try different LFO waves</li>
</ul>
</li>
</ul>
<div class='d-flex flex-row justify-content-around'>
<img src='images/solo-modules/lfo-solo.png' style='height: 300px; width: auto'>
</div>
",solution_html="<img src='images/patch-solutions/pwm-lfo-vco-scope.png' style='height: 300px; width: auto'>")
```

<!-- CAPTION BLOCK -->
```{r pwm-lfo-vco-scope, echo=F, out.width="100%", fig.cap="(ref:pwm-lfo-vco-scope)"}
modular_caption()
```

### Vibrato

Vibrato is movement around pitch that can be defined in terms of speed of movement around a center pitch and depth of movement, or distance from, that same center pitch.
Vibrato is widely used in music, but is perhaps most strongly associated with opera as shown in Figure \@ref(fig:opera-vibrato).

(ref:opera-vibrato) [Youtube video](https://www.youtube.com/watch?v=CPPOrQHiP40) of an opera singer's vibrato, or frequency variation around a central note. Image [© jiggle throat](https://www.youtube.com/channel/UC9FSr2uoO_OqymmeNSE5AyQ).

```{r opera-vibrato, fig.cap="(ref:opera-vibrato)", echo = F}
embed_youtube("CPPOrQHiP40",0)
```

LFOs can create vibrato on a VCO by controlling V/Oct.
Unlike PWM, an additional VCA is needed to control the depth of the vibrato.^[Technically you can use the FM input and attenuator, but there are pedagogical reasons for not using the FM input at the moment, namely that we have not discused FM yet. ]
Try to create vibrato with an LFO using the button in Figure \@ref(fig:vibrato-lfo-vca-vco-scope).
With a little adjustment of the parameters, it's possible to match the vibrato of the opera singer just discussed.
Since no vibrato occurs when the LFO frequency is zero, one can turn the vibrato effect on and off by setting LFO frequency, e.g. through a sequencer.


(ref:vibrato-lfo-vca-vco-scope) [Virtual modular](https://cardinal.olney.ai) for implementing vibrato using a low frequency oscillator (LFO).

<!-- MODAL HTML BLOCK -->
```{r echo=F, out.width="100%"}
modular_modal("vibrato-lfo-vca-vco-scope", starter_file="pwm-lfo-vco-scope.vcv", instructions_html="<ul>
<li>Add a QuadVCA/Mixer between the LFO and VCO </li>
<li>Connect LFO triangle out to QuadVCA input 1</li>
<li>Connect QuadVCA mix out to VCO V/Oct</li>
<li>Connect Scope out 1 to Host audio L</li>
<li>Try the following and note the differences in the sound<ul>
<li>Decrease the depth of the vibrato by adjusting the QuadVCA gain down towards zero</li>
<li>Turn the LFO frequency to zero to hear the raw wave, then increase frequency</li>
<li>Try different LFO waves</li>
</ul>
</li>
</ul>
",solution_html="<img src='images/patch-solutions/vibrato-lfo-vca-vco-scope.png' style='height: 300px; width: auto'>")
```

<!-- CAPTION BLOCK -->
```{r vibrato-lfo-vca-vco-scope, echo=F, out.width="100%", fig.cap="(ref:vibrato-lfo-vca-vco-scope)"}
modular_caption()
```

### Tremolo

In electronic music, tremolo is movement around loudness that can be defined in terms of speed of movement around a center volume and depth of movement, or distance from, that same center volume.^[The mnemonic "tremolo**ud**" might help prevent confusion with vibrato.]
Note that in other forms of music, there are [different definitions of tremolo](https://en.wikipedia.org/wiki/Tremolo).
Tremolo has been widely used in popular guitar music since the 1960's, and guitar pedals producing tremolo effects as shown in Figure \@ref(fig:guitar-tremolo) are quite common today. 

(ref:guitar-tremolo) [Youtube video](https://youtu.be/ZHDV3yBm33A?t=12) of a tremolo guitar pedal. The flashing light corresponds to the speed of loudness changes around a center volume. Image [© CheaperPedals.com](https://www.youtube.com/c/Cheaperpedals).

```{r guitar-tremolo, fig.cap="(ref:guitar-tremolo)", echo = F}
embed_youtube("ZHDV3yBm33A",12)
```

LFOs can create tremolo by controlling the amplitude of VCO output.
A VCA is is used to the depth of the tremelo.
However, there are two differences with respect to previous patches.
First, a VCA accepts unipolar control CV, so the LFO must be set to unipolar.
Second, when the LFO goes to zero, it will completely close the VCA just like an envelope does.
In order to keep some base line of loudness, you must mix a copy of the signal with the signal coming out of the VCA.
Try to create tremolo with an LFO using the button in Figure \@ref(fig:tremelo-lfo-vca-vco-scope) and adjust the parameters to match the tremolo of the guitar pedal in Figure \@ref(fig:guitar-tremolo).
As before, no tremolo occurs when the LFO frequency is zero, so on can turn the tremolo effect on and off by setting LFO frequency using a sequencer or other means.


(ref:tremelo-lfo-vca-vco-scope) [Virtual modular](https://cardinal.olney.ai) for implementing tremolo using a low frequency oscillator (LFO).

<!-- MODAL HTML BLOCK -->
```{r echo=F, out.width="100%"}
modular_modal("tremelo-lfo-vca-vco-scope", starter_file="vibrato-lfo-vca-vco-scope.vcv", instructions_html="<ul>
<li>Disconnect all cables but Scope out 1 to Host audio L and LFO triangle out to Scope in 1</li>
<li>Connect VCO square out to QuadVCA input 1</li>
<li>Connect LFO triangle out 1 to QuadVCA CH 1 gain CV</li>
<li>Connect QuadVCA mix out to Scope in 1</li>
<li>Try the following and note the differences in the sound<ul>
<li>Decrease the depth of the tremelo by adjusting the QuadVCA gain down towards zero</li>
<li>Turn the LFO frequency to zero to hear the raw wave, then increase frequency</li>
</ul>
</li>
<li>Notice the LFO wave on the scope goes below zero but there is no effect on the sound</li>
<li>Fix this by changing the LFO OFST to unipolar</li>
<li>Notice the volume goes to zero when the LFO goes to zero</li>
<li>Fix this by connecting VCO square out to QuadVCA input 2</li>
<li>Adjust the mix to get the right baseline volume and depth of modulation</li>
</ul>
",solution_html="<img src='images/patch-solutions/tremelo-lfo-vca-vco-scope.png' style='height: 300px; width: auto'>")
```

<!-- CAPTION BLOCK -->
```{r tremelo-lfo-vca-vco-scope, echo=F, out.width="100%", fig.cap="(ref:tremelo-lfo-vca-vco-scope)"}
modular_caption()
```

## Sync

sync
- hard/soft



## Noise

noise
- blue snare/red kick

## Samplers

samplers
- sample rate/bit depth
- 12key/lfo

<!-- 		Oscillators (VCO) /LFO ; morphing between waveshapes/ PWM /sync-->
<!-- noise -->
<!-- 		Samplers -->


<!-- Tremelo/vibrato? -->
<!-- Fundamental Modules and Composition		 -->
<!-- 	Basic concepts	 -->
<!-- 		 Module categories, signals, signal interpretation, 5 patchs from drone to key controller for pitch/gate with amplitude envelope -->
<!-- 	Controllers	 -->
<!-- 		Controllers -->
<!-- 		Trigger/gate, phase, sync -->
<!-- 	Generators	 -->
<!-- 		Oscillators (VCO) /LFO ; morphing between waveshapes/ PWM /sync-->
<!-- noise -->
<!-- 		Samplers -->
<!-- 	Modifiers	 -->
<!-- 		Filters (VCF): poles, slopes, cutoff frequency, resonance -->
<!-- 		Envelopes, velocity sensitivity, aftertouch -->
<!-- 		Amplifiers -->
<!-- 		Effects: delay/reverb/panning -->

<!-- Complex modules and Compositions		 -->
<!-- 	Controllers	 -->
<!-- 		Clock, sequencing, arpggiators -->
<!-- 		Euclidean rhythms -->
<!-- 		Probability -->
<!-- 	Generators	 -->
<!-- 		PWM -->
<!-- 		FM/AM -->
<!-- 		Ring modulation -->
<!-- 		Vocoders -->
<!-- 		Random sampling -->
<!-- 	Modifiers	 -->
<!-- 		LFO -->
<!-- 		Sample and hold -->
<!-- 		Slew -->
<!-- 		Wave-folding -->
<!-- 		Attenuators, inverters, and attenuverters -->
<!-- 		Quantizers -->
<!-- 		Switches -->
<!-- 		Logic -->


